{
  "schema_version": "1.2.0",
  "metadata": {
    "draft_name": "ask_my_library",
    "ui": {
      "inputs": [
        { "name": "query", "label": "Ask a question", "type": "string", "required": true, "group": "basic" },
        { "name": "session_id", "label": "Session", "type": "string", "required": false, "group": "basic", "default": "chat_session" },
        { "name": "org_id", "label": "Organization", "type": "string", "required": false, "group": "advanced" },
        { "name": "user_id", "label": "User", "type": "string", "required": false, "group": "advanced" }
      ],
      "design": { "scope": "library", "top_k": 5, "with_citations": false }
    }
  },
  "nodes": [
    {
      "id": "recent",
      "type": "tool",
      "tool_name": "recent_session_tool",
      "tool_args": { "session_id": "{{ inputs.session_id }}", "scope": "library", "org_id": "{{ inputs.org_id }}", "limit": 5 },
      "dependencies": []
    },
    {
      "id": "search",
      "type": "tool",
      "tool_name": "memory_search_tool",
      "tool_args": { "query": "{{ inputs.query }}", "scope": "library", "limit": 5, "org_id": "{{ inputs.org_id }}" },
      "dependencies": []
    },
    {
      "id": "llm",
      "type": "llm",
      "model": "gpt-4o",
      "prompt": "You are helpful. Use user library search results and recent turns.\nQuery: {{ inputs.query }}\nRecent: {{ recent['items'] }}\nResults: {{ search.results }}\n",
      "llm_config": { "provider": "openai", "model": "gpt-4o" },
      "dependencies": ["recent", "search"],
      "output_schema": { "text": "string" }
    },
    {
      "id": "write",
      "type": "tool",
      "tool_name": "memory_write_tool",
      "tool_args": { "key": "chat:{{ inputs.session_id }}:{{ inputs.query }}", "content": "{{ llm.response }}", "scope": "library", "org_id": "{{ inputs.org_id }}", "user_id": "{{ inputs.user_id }}" },
      "dependencies": ["llm"]
    }
  ]
}
