api_version: blueprint.v1
metadata:
  id: seller_assistant_demo
  name: Seller Assistant – CSV → Marketplace
  description: Publish each row of a CSV as a listing, then aggregate results.
  tags: [ecommerce, demo]

nodes:
  - id: load_csv
    type: tool
    tool_name: csv_loader
    tool_args:
      path: "{{ env.CSV_PATH }}"
      delimiter: ","

  - id: loop_rows
    type: loop
    items_source: load_csv.rows
    item_var: item
    body_nodes: [listing_agent]

  - id: listing_agent
    type: tool
    tool_name: listing_agent
    tool_args:
      endpoint_url: "{{ env.ICE_MARKETPLACE_ENDPOINT }}"
      api_key: "{{ env.ICE_MARKETPLACE_API_KEY }}"
      margin_percent: 25.0
      model: gpt-4o
      test_mode: "{{ env.ICE_TEST_MODE | default(true) }}"

  - id: aggregate
    type: tool
    tool_name: aggregator
    dependencies: [loop_rows]
    tool_args:
      results: "{{ loop_rows.results }}"

outputs:
  - aggregate
